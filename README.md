# ネットワーク基礎ハンズオン 設計書（第二弾・詳細化 v3）

---

## 1. 本教材の位置づけ

（※ ここは前版と同じため省略可）

---

## 2. 成功の定義

（※ 前版と同じ）

---

## 3. ブランチ戦略設計（教材としての重要ポイント）

### 3.1 ブランチ構成

```
main
├─ step0-base
├─ step1-port
├─ step2-viewpoint
├─ step3-network-isolation
├─ step4-dns
└─ step5-final-exercise
```

### 3.2 各ブランチの役割

| ブランチ    | 役割               |
| ------- | ---------------- |
| main    | 完成形（講師・答え確認用）    |
| stepX-* | 各ステップの「課題スタート地点」 |

---

### 3.3 ブランチ戦略の思想

* **1ブランチ = 1課題**
* 各ブランチは「壊れた状態」から始まる
* 修正内容は1〜2点に限定
* 正解は1つに限定しない

👉 受講者は
「このブランチを checkout すれば、その課題が始まる」
という分かりやすい導線を得られる。

---

### 3.4 なぜブランチで分けるのか

* ZIP配布でも成立する
* 途中で詰まっても別ブランチに進める
* Git操作は最小限（checkoutのみ）

👉 **Gitの学習教材ではないため、Git操作の負荷を最小化する**

---

## 4. Step3：Dockerネットワーク分離（最重要）詳細設計

---

### 4.1 Step3の学習ゴール（再定義）

受講者は以下を説明できるようになる。

* なぜ同じホスト上のコンテナ同士が通信できないのか
* Dockerネットワークが「見えない境界」として機能している理由
* どうすれば通信できるようになるのか（設計の言葉で）

---

### 4.2 Step3の初期状態（課題ブランチ）

ブランチ名：

```
step3-network-isolation
```

---

### 4.3 提供される構成（あえて壊れている）

#### docker-compose.yml（イメージ）

* frontend（React）
* backend（Node.js API）
* network-a
* network-b

```
frontend ── network-a
backend  ── network-b
```

👉 **frontend → backend は通信できない**

---

### 4.4 受講者が最初に体験すること

1. `docker compose up`
2. フロントエンドにアクセス
3. API通信が失敗する（例：fetch error）

---

### 4.5 READMEに明示するメッセージ（例）

> ❓ コンテナは起動している
> ❓ ポートも公開している
>
> それでも通信できません
>
> **なぜでしょう？**

---

### 4.6 受講者に考えてほしい観点（誘導）

READMEでは以下をヒントとして提示する。

* frontend と backend は

  * 同じネットワークに属しているか？
* 「同じdocker-compose.ymlに書いてある」＝「同じネットワーク」か？
* コンテナ同士はどこを経由して通信しているのか？

---

### 4.7 典型的な失敗例（Tipsとして明示）

#### ❌ 失敗例1：ポートを増やせば繋がると思う

* ports を追加
* 状況が変わらない

👉 ポートは **外部公開用** であり
コンテナ間通信の問題ではない。

---

#### ❌ 失敗例2：localhost を指定する

👉 localhost は
**自分自身（そのコンテナ）** を指す。

---

### 4.8 正解の方向性（答えは1つではない）

READMEでは以下レベルまで示す。

* frontend と backend を

  * 同一ネットワークに参加させる
* ネットワーク境界を越えた通信はできない

※ 具体的なYAMLの書き方は main ブランチで確認可能

---

### 4.9 Step3で身につく「実務に直結する感覚」

* ネットワークは明示的に設計されるもの
* 「動かない」は設定の結果
* 境界を越えるには理由と設計が必要

---

## 5. Step3終了時点での到達イメージ

受講者の発言イメージ：

> 「frontend と backend が別ネットワークなので
> 名前解決もできず、通信できていません。
> 同じネットワークに参加させる必要があります。」

👉 **この一言が言えれば、Step3は成功**

---

## 6. 次ステップへの布石

* Step4：
  「じゃあ、なぜサービス名で通信できるの？」
* Step5：
  「複数要因が絡むと、どう切り分ける？」

---

## 7. この教材の“肝”再確認

* Dockerネットワークは
  **見えないが、確実に存在する**
* 通信トラブルの多くは
  **設計を見れば説明できる**
* 本教材は
  **操作ではなく、理解を教える**

---
